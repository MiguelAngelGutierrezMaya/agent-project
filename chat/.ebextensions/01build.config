###############################################################################
# Build Configuration for Elastic Beanstalk
#
# This file handles:
# 1. Fixing permissions for the webapp user
#
# NOTE: node_modules/ is included in the deployment ZIP to avoid npm install issues
#
# IMPORTANT: 
# - We assume dist/ is already compiled and included in the ZIP
# - No need to rebuild on EB (faster deployment)
# - container_commands run as ROOT, before Procfile executes
#
# Execution order:
# - container_commands run AFTER code is moved to /var/app/current
# - They run as root, BEFORE the Procfile is executed
###############################################################################

container_commands:
  01_fix_permissions:
    command: "chown -R webapp:webapp /var/app/current"
    ignoreErrors: false

###############################################################################
# Notes:
# - node_modules/ is included in the ZIP (to avoid npm install issues on EB)
# - dist/ must be included in the ZIP (compiled before deployment)
# - Permissions are fixed for entire /var/app/current directory to webapp user
# - This ensures Procfile (run as webapp) can access all files
# - ignoreErrors: false means deployment fails if these commands fail
###############################################################################

